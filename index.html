<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Flowdrom</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 20px;
      background: #f5f5f5;
    }

    .container {
      max-width: 1600px;
      margin: 0 auto;
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    h1 {
      color: #2a5eb2;
      margin-bottom: 20px;
      text-align: center;
    }

    .input-section {
      width: 100%;
      margin-bottom: 20px;
    }

    #input {
      width: 100%;
      font-family: 'Courier New', monospace;
      font-size: 16px;
      border: 1px solid #ddd;
      border-radius: 4px;
      padding: 10px;
      resize: vertical;
    }

    .button-group {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }

    button {
      padding: 10px 20px;
      background: #2a5eb2;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
    }

    button:hover {
      background: #1a4a8a;
    }

    button.secondary {
      background: #6c757d;
    }

    button.secondary:hover {
      background: #5a6268;
    }

    #svg-container {
      margin-top: 20px;
      border: 1px solid #ccc;
      border-radius: 4px;
      background: white;
      overflow: auto;
    }

    .lane-label {
      font-weight: bold;
      font-size: 18px;
      text-anchor: middle;
      fill: #2a5eb2;
    }

    .sub-lane-label {
      font-weight: bold;
      font-size: 12px;
      text-anchor: middle;
      fill: #2a5eb2;
    }

    .lane-group-label {
      font-weight: bold;
      font-size: 14px;
      text-anchor: middle;
      fill: #6699cc;
    }

    .lane-group-bracket {
      stroke: #6699cc;
      stroke-width: 2;
      stroke-dasharray: 4,4;
      fill: none;
    }

    .message-label {
      font-size: 15px;
      font-family: 'Courier New', monospace;
      dominant-baseline: middle;
      font-weight: bold; 
    }

    .label-box {
      fill: white;
      stroke: none;
    }

    .state-label {
      font-size: 11px;
      fill: black;
      font-family: sans-serif;
      text-anchor: middle;
    }

    .state-box {
      fill: #ffffcc;
      stroke: #aaa;
      rx: 4;
      ry: 4;
    }

    .arrow {
      stroke-width: 2;
    }

    .dashed {
      stroke-dasharray: 5,5;
    }

    .time-label {
      font-size: 12px;
      fill: #666;
      font-family: sans-serif;
    }

    .grid-line {
      stroke: #eee;
      stroke-width: 1;
    }

    .export-section {
      margin-top: 20px;
      padding: 15px;
      background: #f8f9fa;
      border-radius: 6px;
      border: 1px solid #e9ecef;
    }

    .legend-box {
      fill: white;
      stroke: #ccc;
      stroke-width: 1;
      rx: 6;
      ry: 6;
    }

    .legend-title {
      font-weight: bold;
      font-size: 16px;
      fill: #2a5eb2;
    }

    .legend-label {
      font-size: 27px;
      font-family: 'Courier New', monospace;
      dominant-baseline: middle;
    }

    .info-box {
      fill: white;
      stroke: #333;
      stroke-width: 1;
      rx: 4;
      ry: 4;
    }

    .info-box-text {
      font-size: 12px;
      font-family: 'Segoe UI', sans-serif;
      fill: #333;
    }

    .info-box-line {
      stroke: #333;
      stroke-width: 1;
      stroke-dasharray: 3,3;
      fill: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="input-section">
      <label for="input"><strong>Transaction JSON (use "|" for line breaks):</strong></label>
      <textarea id="input" rows="30">{
  "title": "Conflict: Two CAs ReadUnique Same Address",
  "lanes": ["CA0", "_D2D_", "CA1", "HN", "HN.MEM"],
  "laneGroups": [
    { "label": "Caching Agents", "lanes": ["CA0", "CA1"] },
    { "label": "System", "lanes": ["HN", "HN.MEM"] }
  ],
  "infoBoxes": [
    { "lane": "HN", "time": 2, "text": "Conflict detected|serialize requests" }
  ],
  "messages": [
    { "path": "CA0->HN", "label": "Read|Unique(A)", "color": "red", "style": "solid", "fromTime": 0, "toTime": 1 },
    { "path": "CA1->HN", "label": "Read|Unique(A)", "color": "red", "style": "dashed", "fromTime": 1, "toTime": 2 },
    { "path": "HN->HN.MEM", "label": "Rd(A)", "color": "orange", "style": "solid", "fromTime": 2, "toTime": 3 },
    { "path": "HN.MEM->HN", "label": "D(A)", "color": "orange", "style": "solid", "fromTime": 4, "toTime": 5.5 },
    { "path": "HN->CA1", "label": "SnpInvalid(A)", "color": "purple", "style": "solid", "fromTime": 2, "toTime": 4 },
    { "path": "CA1->HN", "label": "SnpResp(I)", "color": "green", "style": "solid", "fromTime": 4, "toTime": 6 },
    { "path": "HN->CA0", "label": "CompData(A)", "color": "blue", "style": "solid", "fromTime": 6, "toTime": 7 },
    { "path": "HN->CA1", "label": "Retry", "color": "red", "style": "dashed", "fromTime": 7, "toTime": 8 }
  ],
  "states": [
    { "lane": "CA0", "label": "I->UD", "color": "yellow", "fromTime": 0, "toTime": 0.5 },
    { "lane": "CA1", "label": "S->I", "color": "orange", "fromTime": 4, "toTime": 4.5 },
    { "lane": "HN", "label": "Conflict", "color": "red", "fromTime": 2, "toTime": 7 }
  ],
  "legend": [
    { "label": "Request", "color": "red", "style": "solid" },
    { "label": "Conflicted", "color": "red", "style": "dashed" },
    { "label": "Snoop", "color": "purple", "style": "solid" },
    { "label": "Response", "color": "green", "style": "solid" },
    { "label": "Memory", "color": "orange", "style": "solid" },
    { "label": "Complete", "color": "blue", "style": "solid" }
  ]
}</textarea>
      <div class="button-group">
        <button onclick="renderGraph()">Render</button>
        <button onclick="exportSVG(true)">Export SVG</button>
        <button onclick="exportPNG()">Export PNG</button>
        <input type="file" id="svgFileInput" accept=".svg" style="display: none;" onchange="loadSVGFile(event)">
        <button onclick="document.getElementById('svgFileInput').click()">Load SVG</button>
      </div>
    </div>

    <h1 id="graph-title" style="display: none;">Enhanced Transaction Sequence Graph</h1>
    <div id="svg-container"></div>
  </div>

   <script src="src/js/main.js"></script>
  </body>
</html>
